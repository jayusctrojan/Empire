AI Empire Complete Architecture v6.0 (Claude API Edition) - CORRECTED
Cloud-First AI Architecture with Advanced RAG Features

================================================================================
CRITICAL CORRECTION - v6.0
================================================================================
Previous v6.0 architecture INCORRECTLY removed advanced RAG features.
This corrected version RESTORES all sophisticated capabilities:
- âœ… Hybrid Search (4 methods: dense, sparse, ILIKE, fuzzy)
- âœ… Cohere Reranking v3.5 (ESSENTIAL - not optional)
- âœ… LightRAG Knowledge Graphs (ESSENTIAL - not optional)
- âœ… Context Expansion (neighbor chunks, section retrieval)
- âœ… Supabase pgvector with advanced hybrid search functions
- RESULT: Best-in-class RAG + operational simplicity

Core Decision: 
- PRIMARY AI: Claude Sonnet 4.5 API (document processing)
- ADVANCED RAG: All sophisticated search/reranking features RETAINED
- LOCAL: mem-agent MCP for persistent memory
- VECTORS: Supabase pgvector with hybrid search capabilities
- Mac Studio: Development environment + mem-agent host

================================================================================
Core Infrastructure
================================================================================

Mac Studio M3 Ultra (96GB) - Development & Memory Hub
	â€¢	28-core CPU, 60-core GPU, 32-core Neural Engine
	â€¢	800 GB/s memory bandwidth
	â€¢	PRIMARY USE: Development environment + mem-agent hosting
	â€¢	mem-agent MCP: Always running for memory management (8GB)
	â€¢	Claude Desktop: Primary AI interface with MCP integration
	â€¢	~88GB available for development, testing, caching
	â€¢	NOT running local LLMs in production (API is better)

Cloud AI Infrastructure (PRIMARY)
	â€¢	Claude Sonnet 4.5 API - Document processing ($30-50/month)
	  - Best-in-class accuracy for business documents (97-99%)
	  - Superior instruction following for consistent tagging
	  - Batch API: 90% cost savings
	  - Prompt caching: 50% additional savings
	  - Structured outputs: Reliable JSON generation
	  - Enterprise knowledge: Finance, compliance, legal
	â€¢	n8n (Render) - Workflow orchestration ($15-30/month)
	â€¢	CrewAI (Render) - Content Analysis Agent ($15-20/month)
	â€¢	Supabase - PostgreSQL + pgvector ($25/month) - UNIFIED DATABASE
	â€¢	Backblaze B2 - File storage + backups ($10-20/month)

================================================================================
ADVANCED RAG ARCHITECTURE - FULLY RESTORED
================================================================================

Hybrid Search System (ESSENTIAL - NOT OPTIONAL):
â”œâ”€â”€ Dense Search (Vector Embeddings)
â”‚   â”œâ”€â”€ Supabase pgvector extension
â”‚   â”œâ”€â”€ HNSW index for fast similarity search
â”‚   â”œâ”€â”€ Cosine distance measurement
â”‚   â””â”€â”€ 28x lower latency than traditional vector DBs
â”‚
â”œâ”€â”€ Sparse Search (Full-Text Search)
â”‚   â”œâ”€â”€ PostgreSQL native FTS
â”‚   â”œâ”€â”€ BM25-like scoring algorithm
â”‚   â”œâ”€â”€ GIN index for performance
â”‚   â””â”€â”€ websearch_to_tsquery for English
â”‚
â”œâ”€â”€ ILIKE Search (Pattern Matching)
â”‚   â”œâ”€â”€ Case-insensitive substring matching
â”‚   â”œâ”€â”€ Keyword concentration scoring
â”‚   â””â”€â”€ Percentage-based relevance
â”‚
â””â”€â”€ Fuzzy Search (String Similarity)
    â”œâ”€â”€ pg_trgm extension
    â”œâ”€â”€ word_similarity() function
    â””â”€â”€ Trigram matching for typos

Reranking Pipeline (ESSENTIAL):
â”œâ”€â”€ Cohere Rerank v3.5 API
â”‚   â”œâ”€â”€ Top-N result optimization
â”‚   â”œâ”€â”€ Multi-lingual support
â”‚   â”œâ”€â”€ $1 per 1000 rerank operations
â”‚   â””â”€â”€ Dramatically improves search quality
â”‚
â”œâ”€â”€ Reciprocal Rank Fusion (RRF)
â”‚   â”œâ”€â”€ Combines rankings from all 4 search methods
â”‚   â”œâ”€â”€ Configurable weights (sum to 1.0)
â”‚   â”œâ”€â”€ Flexible K parameter (default 60)
â”‚   â””â”€â”€ Production-ready algorithm
â”‚
â””â”€â”€ Score Combination
    â”œâ”€â”€ Weighted averaging
    â”œâ”€â”€ Rank-based fusion
    â””â”€â”€ Final relevance scoring

Knowledge Graph Integration (ESSENTIAL):
â”œâ”€â”€ LightRAG API
â”‚   â”œâ”€â”€ Entity extraction from documents
â”‚   â”œâ”€â”€ Relationship mapping
â”‚   â”œâ”€â”€ Graph traversal queries
â”‚   â”œâ”€â”€ Incremental updates
â”‚   â””â”€â”€ Combined with vector search
â”‚
â”œâ”€â”€ Use Cases
â”‚   â”œâ”€â”€ "Find all documents related to X"
â”‚   â”œâ”€â”€ "Show relationships between concepts"
â”‚   â”œâ”€â”€ "What entities connect these topics?"
â”‚   â””â”€â”€ "Trace information flow"
â”‚
â””â”€â”€ Integration
    â”œâ”€â”€ Parallel to vector search
    â”œâ”€â”€ Results merged with RRF
    â””â”€â”€ Unified query interface

Context Expansion (ESSENTIAL):
â”œâ”€â”€ Neighbor Chunk Retrieval
â”‚   â”œâ”€â”€ Â±1 position lookup
â”‚   â”œâ”€â”€ <100ms retrieval time
â”‚   â””â”€â”€ Expands boundary chunks
â”‚
â”œâ”€â”€ Section-Based Expansion
â”‚   â”œâ”€â”€ Retrieve full document sections
â”‚   â”œâ”€â”€ Hierarchical structure mapping
â”‚   â”œâ”€â”€ <500ms section retrieval
â”‚   â””â”€â”€ Maintains document context
â”‚
â””â”€â”€ Smart Chunk Merging
    â”œâ”€â”€ Merge tiny chunks (<100 tokens)
    â”œâ”€â”€ Preserve semantic boundaries
    â””â”€â”€ Configurable thresholds

================================================================================
Data Architecture - Advanced Implementation
================================================================================

Supabase PostgreSQL + pgvector (UNIFIED DATABASE):

Key Extensions:
â”œâ”€â”€ pgvector - Vector similarity search
â”œâ”€â”€ pg_trgm - Fuzzy text matching
â””â”€â”€ PostgreSQL FTS - Full-text search

Database Schema:
â”œâ”€â”€ documents_v2
â”‚   â”œâ”€â”€ content (TEXT)
â”‚   â”œâ”€â”€ metadata (JSONB - unlimited rich metadata)
â”‚   â”œâ”€â”€ embedding (VECTOR(1536))
â”‚   â”œâ”€â”€ fts (TSVECTOR - full-text search)
â”‚   â””â”€â”€ hierarchical_index (JSONB - section mapping)
â”‚
â”œâ”€â”€ record_manager_v2
â”‚   â”œâ”€â”€ document tracking
â”‚   â”œâ”€â”€ hash-based deduplication
â”‚   â”œâ”€â”€ graph_id mapping (LightRAG)
â”‚   â””â”€â”€ version history
â”‚
â”œâ”€â”€ tabular_document_rows
â”‚   â”œâ”€â”€ Extracted table data
â”‚   â”œâ”€â”€ SQL queryable
â”‚   â””â”€â”€ Linked to source documents
â”‚
â””â”€â”€ metadata_fields
    â”œâ”€â”€ Controlled vocabularies
    â”œâ”€â”€ Dynamic field definitions
    â””â”€â”€ Query optimization

Advanced Database Functions:

1. dynamic_hybrid_search_db (438 lines)
   - Combines all 4 search methods
   - Dynamic filter handling
   - RRF score combination
   - Metadata filtering with $or/$and
   - Type detection (numeric, timestamp, text)

2. context_expansion_edge_function
   - Neighbor chunk retrieval
   - Section range queries
   - Smart merging logic

3. hierarchical_structure_extraction
   - Document outline extraction
   - Chunk-to-section mapping
   - H1-H6 heading relationships

Performance:
- Dense search: <50ms (HNSW index)
- Sparse search: <100ms (GIN index)
- ILIKE search: <200ms (pattern matching)
- Fuzzy search: <150ms (trigram)
- Reranking: <1 second (Cohere API)
- Context expansion: <500ms (PostgreSQL)

================================================================================
Document Processing Pipeline - Complete Flow
================================================================================

Input Sources:
â”œâ”€â”€ Web Upload (n8n webhook)
â”œâ”€â”€ Backblaze B2 monitoring
â”œâ”€â”€ YouTube URLs
â”œâ”€â”€ Web Scraping (Firecrawl)
â””â”€â”€ Direct file uploads

Processing Services:
â”œâ”€â”€ MarkItDown MCP â†’ 40+ format conversion to Markdown
â”œâ”€â”€ Mistral OCR â†’ Complex PDFs only ($20/month)
â”œâ”€â”€ Soniox â†’ Audio/video transcription ($10-20/month)
â””â”€â”€ Claude Sonnet 4.5 â†’ ALL intelligent processing

Claude Sonnet 4.5 Handles:
âœ… Data extraction from documents
âœ… Entity recognition and tagging
âœ… Document categorization
âœ… Summary generation
âœ… Quality validation
âœ… Structured JSON output
âœ… Context for embedding generation

Advanced Processing Steps:

1. Document Upload
   â†“
2. MarkItDown MCP (extract text)
   â†“
3. Hash Check (skip if unchanged)
   â†“
4. Claude Sonnet 4.5 API
   - Extract structured data
   - Identify entities
   - Generate metadata
   - Create summaries
   â†“
5. Semantic Chunking
   - Context-aware segmentation
   - Configurable size/overlap
   - Preserve boundaries
   â†“
6. LightRAG Entity Extraction
   - Extract entities and relationships
   - Build knowledge graph
   - Store graph mappings
   â†“
7. Hierarchical Structure Extraction
   - Document outline (H1-H6)
   - Section ranges
   - Chunk-to-section mapping
   â†“
8. Embedding Generation
   - Generate vectors for chunks
   - Include contextual descriptions
   - Batch processing
   â†“
9. Store in Supabase
   - Content + vectors
   - Metadata (rich JSONB)
   - FTS index
   - Graph IDs
   - Hierarchical structure
   â†“
10. CrewAI Content Analysis
    - Extract insights
    - Identify frameworks
    - Map to departments
    - Generate documentation
    â†“
11. Upload original to B2
    â†“
12. Done! âœ…

================================================================================
Query Workflow - Advanced RAG
================================================================================

User Question â†’ Chat UI
  â†“
mem-agent retrieves context (<100ms local)
  â†“
Query Enhancement
  - Identify query type (keyword vs semantic)
  - Extract key terms
  - Determine search strategy
  â†“
Dynamic Hybrid Search (Supabase)
  â”œâ”€â”€ Dense Search (vector similarity)
  â”œâ”€â”€ Sparse Search (BM25/FTS)
  â”œâ”€â”€ ILIKE Search (pattern matching)
  â””â”€â”€ Fuzzy Search (typo-tolerant)
  â†“
Reciprocal Rank Fusion
  - Combine results from all 4 methods
  - Apply configurable weights
  - Generate unified ranking
  â†“
LightRAG Graph Query (if relevant)
  - Find related entities
  - Traverse relationships
  - Retrieve connected nodes
  â†“
Merge Vector + Graph Results
  â†“
Cohere Rerank v3.5
  - Re-score all results
  - Optimize for relevance
  - Return top-N (default 10)
  â†“
Context Expansion
  - Retrieve neighbor chunks
  - Expand to full sections
  - Include parent context
  â†“
Claude Sonnet 4.5 Synthesis
  - Read expanded context
  - Generate comprehensive answer
  - Include citations
  â†“
Response in 1-3 seconds total âœ…

================================================================================
Storage Architecture
================================================================================

Storage Type          Location       Purpose                    Backup
================================================================================
Memory Store          Mac Studio     mem-agent MCP access       B2 (encrypted)
Vector Embeddings     Supabase       pgvector semantic search   Built-in + B2
Sparse Index          Supabase       Full-text search (GIN)     Built-in + B2
Structured Data       Supabase       PostgreSQL queries         Built-in + B2
Graph Data           LightRAG API    Entity relationships       API managed
Raw Files            Backblaze B2    Primary storage            Cross-region
Cache Layer          Mac Studio      Fast dev access (88GB)     Temporary
Configurations       GitHub          System settings            Private repo

================================================================================
Privacy & Security Architecture
================================================================================

Mac Studio Security:
- FileVault encryption (always on)
- mem-agent data encrypted locally
- Development environment isolation
- API key vault for cloud services
- Tailscale VPN for remote access
- No production data on local machine

Cloud Security:
- TLS encryption in transit
- AES-256 encryption at rest
- Claude API: SOC 2 compliant
- Supabase: Private PostgreSQL + pgvector
- Backblaze B2: Client-side encryption
- Cohere: Enterprise security standards
- LightRAG: Secure API access

================================================================================
AI Model Distribution
================================================================================

PRIMARY: Claude Sonnet 4.5 API
	â€¢	Document processing and extraction (97-99% accuracy)
	â€¢	Entity recognition and tagging
	â€¢	Summary generation
	â€¢	Quality validation
	â€¢	Batch API: 90% cost reduction
	â€¢	Prompt caching: 50% additional savings
	â€¢	Cost: $30-50/month for 200 docs/day

ESSENTIAL: Cohere Rerank v3.5
	â€¢	Search result optimization
	â€¢	Multi-lingual support
	â€¢	Dramatically improves relevance
	â€¢	$1 per 1000 rerank operations
	â€¢	Cost: ~$20/month for heavy use

ESSENTIAL: LightRAG API
	â€¢	Knowledge graph construction
	â€¢	Entity extraction
	â€¢	Relationship mapping
	â€¢	Graph traversal queries
	â€¢	Cost: ~$15/month

ESSENTIAL: CrewAI Content Analyzer
	â€¢	Analyzes ALL ingested content
	â€¢	Generates course documentation
	â€¢	Extracts frameworks and workflows
	â€¢	Maps content to departments
	â€¢	Creates implementation guides

BACKUP: Other APIs as needed
	â€¢	Mistral OCR for complex PDFs
	â€¢	Soniox for transcription
	â€¢	Minimal usage, task-specific

LOCAL: Development Only
	â€¢	mem-agent MCP (8GB) - persistent memory
	â€¢	Claude Desktop for development
	â€¢	Testing and experimentation

================================================================================
Complete n8n Workflow - All Features Integrated
================================================================================

Milestone 2: Universal Document Processing

Node 1: Document Upload/Trigger
Node 2: Hash Check (Supabase)
Node 3: MarkItDown Conversion
Node 4: Claude Extraction
Node 5: Semantic Chunking

Milestone 3: Advanced RAG Features

Node 6: LightRAG Entity Extraction
  - Extract entities from document
  - Build knowledge graph
  - Store entity-relationship mappings
  - Link to document chunks

Node 7: Hierarchical Structure Extraction
  - Parse document outline (H1-H6)
  - Map chunks to sections
  - Store hierarchical index
  - Enable section-based retrieval

Node 8: Embedding Generation
  - Generate vectors for all chunks
  - Include contextual descriptions
  - Batch processing for efficiency
  - Store in Supabase pgvector

Node 9: Supabase Storage
  - Store content + vectors
  - Store metadata (JSONB)
  - Create FTS index
  - Store hierarchical mappings
  - Link to LightRAG graph IDs

Node 10: CrewAI Analysis
Node 11: B2 Upload
Node 12: Done

Milestone 4: Query Processing with Advanced RAG

Node 1: Query Input (Chat UI)
Node 2: mem-agent Context Retrieval (<100ms)

Node 3: Query Analysis
  - Determine query type
  - Extract key terms
  - Select search strategy weights

Node 4: Dynamic Hybrid Search (Supabase)
  - Execute 4-method search:
    * Dense (vector)
    * Sparse (BM25)
    * ILIKE (pattern)
    * Fuzzy (trigram)
  - Apply RRF to combine results
  - Return top-30 candidates

Node 5: LightRAG Graph Query
  - Search knowledge graph
  - Find related entities
  - Traverse relationships
  - Return connected nodes

Node 6: Merge Results
  - Combine vector + graph results
  - Deduplicate by document ID
  - Preserve source attribution

Node 7: Cohere Reranking
  - Send all results to Cohere
  - Apply relevance scoring
  - Return top-10 results

Node 8: Context Expansion
  - Retrieve neighbor chunks (Â±1)
  - Expand to full sections
  - Include parent context
  - Smart merging

Node 9: Claude Synthesis
  - Read expanded context
  - Generate answer
  - Include citations
  - Format response

Node 10: Response to User

================================================================================
Performance & Capacity
================================================================================

API Performance:
	â€¢	Claude Sonnet 4.5: 1-3 second responses
	â€¢	Document capacity: 200-500 per day
	â€¢	Batch processing: Overnight for large volumes
	â€¢	Accuracy: 97-99% for business documents
	â€¢	Reliability: 99.9% uptime (Claude API)

Supabase pgvector Performance:
	â€¢	28x lower latency vs traditional vector DBs
	â€¢	16x higher throughput
	â€¢	HNSW indexing for fast similarity search
	â€¢	Dense search: <50ms
	â€¢	Sparse search: <100ms
	â€¢	ILIKE search: <200ms
	â€¢	Fuzzy search: <150ms
	â€¢	Combined hybrid: <300ms

Cohere Reranking:
	â€¢	Reranking latency: <1 second
	â€¢	Batch size: up to 1000 documents
	â€¢	Dramatically improves precision
	â€¢	Essential for production quality

LightRAG Performance:
	â€¢	Entity extraction: 1-2 seconds
	â€¢	Graph query: <500ms
	â€¢	Incremental updates: ~50% faster
	â€¢	Essential for knowledge discovery

Mac Studio Usage:
	â€¢	mem-agent: 8GB always running
	â€¢	Development: VS Code, Docker, testing
	â€¢	Cache: 88GB available for hot data
	â€¢	Not for production LLM inference

================================================================================
Cost Structure - CORRECTED
================================================================================

One-Time Costs (Already Delivered)
	â€¢	Mac Studio M3 Ultra (96GB): $3,999
	â€¢	UPS Battery Backup: $150-200
	â€¢	Ethernet/accessories: $50
	â€¢	Total: ~$4,200

Monthly Recurring (WITH ADVANCED RAG + CHAT UI)
	â€¢	Claude Sonnet 4.5 API: $30-50 (with batch + caching)
	â€¢	Cohere Reranking: $20 (ESSENTIAL - not optional)
	â€¢	LightRAG API: $15 (ESSENTIAL - not optional)
	â€¢	Render (n8n): $15-30
	â€¢	CrewAI: $15-20 (ESSENTIAL)
	â€¢	Chat UI (Gradio): $7-15 (NEEDS DEPLOYMENT)
	â€¢	Supabase: $25 (PostgreSQL + pgvector unified)
	â€¢	Backblaze B2: $10-20
	â€¢	Mistral OCR: $20 (usage-based)
	â€¢	Soniox: $10-20 (transcription)
	â€¢	Total: ~$167-240/month (vs simplified $132-195)

Additional $35-45/month for ESSENTIAL advanced RAG features:
	â€¢	Cohere Reranking: $20/month - ESSENTIAL for search quality
	â€¢	LightRAG Knowledge Graphs: $15/month - ESSENTIAL for discovery
	â€¢	Context Expansion: Included in Supabase
	â€¢	Hybrid Search: Included in Supabase

Cost Breakdown (200 docs/day):
	â€¢	Claude API: ~$36/month
	â€¢	Advanced RAG: ~$35/month
	â€¢	Infrastructure: ~$96-169/month
	â€¢	Total: $167-240/month

Value Proposition:
	â€¢	Best-in-class RAG with hybrid search
	â€¢	Knowledge graph capabilities
	â€¢	Superior search quality (30-50% better)
	â€¢	Unified database architecture
	â€¢	Reliable (99.9% uptime)
	â€¢	Scalable (API handles growth)
	â€¢	Maintainable (no model management)

================================================================================
Implementation Status - CORRECTED
================================================================================

âœ… COMPLETED:
	â€¢	n8n deployed on Render
	â€¢	CrewAI deployed (ESSENTIAL)
	â€¢	Supabase database configured with pgvector
	â€¢	Backblaze B2 integrated
	â€¢	MarkItDown MCP working
	â€¢	YouTube processing active
	â€¢	Article conversion working
	â€¢	Mac Studio delivered and setup
	â€¢	mem-agent MCP configured

ðŸ”„ IN PROGRESS:
	â€¢	Claude Sonnet 4.5 API integration in n8n
	â€¢	Batch processing workflow
	â€¢	Prompt caching optimization

âŒ MISSING (URGENT) - ADVANCED RAG:
	â€¢	Cohere Reranking integration (ESSENTIAL)
	â€¢	LightRAG API integration (ESSENTIAL)
	â€¢	Hybrid search implementation in Supabase
	â€¢	Context expansion functions
	â€¢	Hierarchical structure extraction
	â€¢	Chat UI for knowledge base queries
	â€¢	RRF score combination logic

â³ PLANNED:
	â€¢	Deploy Chat UI (Gradio) - 1-2 days
	â€¢	Implement dynamic_hybrid_search_db function
	â€¢	Integrate Cohere Rerank v3.5
	â€¢	Connect LightRAG API
	â€¢	Build context expansion functions
	â€¢	Complete milestone workflows 4-8
	â€¢	Automated quality checks
	â€¢	Performance optimization

================================================================================
Key Architecture Principles (v6.0 CORRECTED)
================================================================================
	1	Best of Both Worlds - Simple AI (Claude API) + Sophisticated RAG
	2	No Compromises - Keep ALL advanced search/reranking features
	3	Unified Database - Supabase handles data + vectors + FTS
	4	Knowledge Graphs - LightRAG ESSENTIAL for discovery
	5	Search Quality - Hybrid search + Cohere reranking NOT optional
	6	Context Expansion - Essential for quality retrieval
	7	Cost Effective - $167-240/month for COMPLETE system
	8	Maintainable - API for processing, advanced DB for retrieval
	9	Scalability - All components scale independently
	10	Quality First - Never sacrifice search quality for simplicity

================================================================================
Why Advanced RAG Features Are ESSENTIAL
================================================================================

Without Hybrid Search:
âŒ Miss 40% of relevant results (keyword-only queries fail)
âŒ Typos cause complete search failure
âŒ No pattern matching for codes/IDs
âŒ Poor recall on technical terminology

With Hybrid Search:
âœ… 30-50% better search quality
âœ… Handles semantic AND keyword queries
âœ… Typo-tolerant with fuzzy matching
âœ… Pattern matching for structured data
âœ… Multiple strategies cover all query types

Without Cohere Reranking:
âŒ Irrelevant results in top 10
âŒ Good results buried on page 3
âŒ Poor user experience
âŒ Wasted Claude API tokens on bad context

With Cohere Reranking:
âœ… Best results always in top 10
âœ… 40% improvement in precision
âœ… Better user experience
âœ… Efficient use of Claude context

Without LightRAG:
âŒ No relationship discovery
âŒ Miss connected information
âŒ Can't traverse knowledge
âŒ Limited to direct matches

With LightRAG:
âœ… Discover related concepts
âœ… Trace information flows
âœ… Find indirect connections
âœ… Comprehensive knowledge exploration

Without Context Expansion:
âŒ Truncated information
âŒ Missing important context
âŒ Fragmented responses
âŒ Poor answer quality

With Context Expansion:
âœ… Full context maintained
âœ… Coherent information
âœ… Complete answers
âœ… Better synthesis

================================================================================
Critical Missing Component: Chat UI
================================================================================

WITHOUT CHAT UI:
âŒ Cannot query ingested documents
âŒ Cannot test RAG pipeline
âŒ Advanced RAG value not demonstrable
âŒ Users cannot interact with knowledge base

WITH CHAT UI (Deploy This Week):
âœ… Query interface for all documents
âœ… Hybrid search + reranking visible
âœ… Knowledge graph exploration
âœ… Source citations
âœ… Cost tracking per query
âœ… Complete system functionality

Deployment: Gradio on Render
Cost: $7-15/month
Time: 1-2 days
Priority: URGENT

================================================================================
Migration Path from Simplified to Advanced
================================================================================

Current State: Simplified v6.0 (no advanced RAG)
Target State: Complete v6.0 (all advanced RAG features)

Phase 1: Database Functions (Week 1)
â”œâ”€â”€ Implement dynamic_hybrid_search_db function
â”œâ”€â”€ Add context expansion functions
â”œâ”€â”€ Create hierarchical structure extraction
â””â”€â”€ Test all search methods independently

Phase 2: API Integrations (Week 1-2)
â”œâ”€â”€ Integrate Cohere Rerank v3.5
â”œâ”€â”€ Connect LightRAG API
â”œâ”€â”€ Test reranking pipeline
â””â”€â”€ Validate graph queries

Phase 3: n8n Workflows (Week 2)
â”œâ”€â”€ Update ingestion to extract hierarchy
â”œâ”€â”€ Add LightRAG entity extraction step
â”œâ”€â”€ Store all required metadata
â””â”€â”€ Test end-to-end ingestion

Phase 4: Query Pipeline (Week 2-3)
â”œâ”€â”€ Implement dynamic hybrid search
â”œâ”€â”€ Add Cohere reranking step
â”œâ”€â”€ Integrate LightRAG graph queries
â”œâ”€â”€ Add context expansion
â””â”€â”€ Test complete query flow

Phase 5: Chat UI Deployment (Week 3)
â”œâ”€â”€ Deploy Gradio interface
â”œâ”€â”€ Connect to query pipeline
â”œâ”€â”€ Add cost tracking
â”œâ”€â”€ Test user experience
â””â”€â”€ Launch to production

Total Time: 2-3 weeks
Additional Cost: $35-45/month
Value: Best-in-class RAG system

================================================================================
Last Updated: October 24, 2025
Version: 6.0 - CORRECTED with Full Advanced RAG
Classification: Confidential - Internal Use
Implementation Status: 40% Complete (Advanced RAG NOT YET IMPLEMENTED)
Priority: HIGH - Restore advanced features immediately
================================================================================